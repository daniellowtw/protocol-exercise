# Protocol

This defines a protocol where the server streams some random numbers to the client in a fault tolerant manner.
The protocol has two modes: stateless and stateful mode.

## Stateless

The server streams a list of numbers, doubling the previous number each time.

### New connection:
* Client connects to server with empty request.
* Server generates a random number a in 1..0xff
* Server streams a, 2a, 4a, ...

### Reconnections:
* Client connects to server with a request payload containing the last received.
* Server uses the given number a and stream 2a, 4a, ...

### Stopping condition:
* Client receives up to `n` numbers and then closes the connection.

## Stateful

The server streams a random number of random numbers in the range [1..0xffff].
The numbers are generated by a pseudo random number generator that is seeded by a nonce associated with the client.
The server stores the state for reconnection and expires them after some time.

### New connection
* Client connects with `Request{clientID, totalMsgs, msgReceived}`.
  * Client generates `totalMsg` from the range [0, 0xffff].
  * Client generates a random clientID string.
* Server generates a nonce, stores this with metadata and associates it with the clientID
* Server generates a deterministic stream of random number using nonce.
* Server computes check sum in the last message.

### Reconnection
* Client reconnects with `clientID` and a flag `isReconnect`.
* Server retrieve associated metadata and resume previous state.
  * Server returns error if the clientID does not have a valid state.
  * Server should support reconnection if it's within a window.
* Server continues to stream data as before.
* Server checks the last message sent timestamp and returns an error if it has expired.

### Stopping condition
* The server sends a total of totalMsg and then closes the connection.
* The client expects the last message received to have a checksum.
* The client computes the check sum the same way the server does and compares against the checksum it received.
